import { readFileSync, writeFileSync } from 'node:fs';
import { resolve } from 'node:path';
import { fileURLToPath } from 'node:url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = resolve(__filename, '..', '..');

const filesInOrder = [
  'docs/utils/currency.js',
  'docs/ui/tabs.js',
  'docs/ui/simple-simulator.js',
  'docs/ui/advanced-simulator.js',
  'docs/main.js',
];

function stripModuleSyntax(code) {
  return (
    code
      // Remove import statements.
      .replace(/^import\s+[^;]+;/gm, '')
      // Replace `export function` / `export const` etc. with plain declarations.
      .replace(/export\s+(function|class|const|let|var)/g, '$1')
      // Drop bare export statements like `export { foo };`.
      .replace(/export\s*\{[^}]+\};?/g, '')
  );
}

const bundled = filesInOrder
  .map((relativePath) => {
    const absolutePath = resolve(__dirname, relativePath);
    const content = readFileSync(absolutePath, 'utf8');
    return stripModuleSyntax(content).trim();
  })
  .join('\n\n');

const banner = `// Auto-generated by scripts/bundle-ui.mjs. Do not edit directly.\n`;
writeFileSync(
  resolve(__dirname, 'docs/app.js'),
  `${banner}${bundled}\n`,
  'utf8'
);
